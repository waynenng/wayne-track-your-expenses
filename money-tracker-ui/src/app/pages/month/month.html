<h2>Expenses</h2>

<!-- üîÅ Currency selector -->
<label>
  Currency:
  <select [(ngModel)]="currency">
    <option value="RM">RM</option>
    <option value="$">$</option>
  </select>
</label>

<hr />

<!-- ‚ûï Add Expense Form -->
<form (ngSubmit)="addExpense()" style="margin-bottom: 1rem">

  <input
    type="number"
    step="0.01"
    placeholder="Amount"
    [(ngModel)]="amount"
    name="amount"
    required
  />

  <input
    type="text"
    placeholder="Description"
    [(ngModel)]="description"
    name="description"
    required
  />

  <input
    type="date"
    [(ngModel)]="date"
    name="date"
    required
  />

  <!-- üìÇ Category selector -->
  <select [(ngModel)]="categoryId" name="categoryId" required>
    <option *ngFor="let c of categories" [value]="c.id">
      {{ c.name }}
    </option>
  </select>

  <button type="submit">Add Expense</button>
</form>

<!-- üìä Expenses Table (FIXED: reactive + async pipe) -->
<table
  *ngIf="expenses$ | async as expenses; else empty"
  border="1"
  cellpadding="8"
>
  <thead>
  <tr>
    <th>Date</th>
    <th>Description</th>
    <th>Category</th>
    <th>Amount</th>
  </tr>
  </thead>

  <tbody>
  <tr *ngFor="let e of expenses">
    <td>{{ e.date | date:'dd MMM yyyy' }}</td>
    <td>{{ e.description }}</td>
    <td>{{ getCategoryName(e.categoryId) }}</td>
    <td>{{ currency }} {{ e.amount | number:'1.2-2' }}</td>
  </tr>
  </tbody>
</table>

<ng-template #empty>
  <p>No expenses found.</p>
</ng-template>

<button (click)="back()">‚Üê Back</button>
